docker compose logs -f simulavoto
WARN[0000] Found multiple config files with supported names: /opt/simulavoto/docker-compose.yml, /opt/simulavoto/docker-compose.yaml 
WARN[0000] Using /opt/simulavoto/docker-compose.yml     
simulavoto  | === SimulaVoto - Sistema Eleitoral Brasileiro ===
simulavoto  | Environment: production
simulavoto  | Port: 5000
simulavoto  | Database mode: EXTERNAL (Supabase/cloud)
simulavoto  | Host: 72.60.255.204:5432
simulavoto  | Host is already an IPv4 address: 72.60.255.204
simulavoto  | DATABASE_SSL=auto
simulavoto  | SSL: auto mode - testing connection...
simulavoto  | SSL: SSL failed, testing without SSL...
simulavoto  | SSL: connected WITHOUT SSL
simulavoto  | Final host: 72.60.255.204
simulavoto  | 
simulavoto  | Running database schema sync (db:push)...
simulavoto  | 
simulavoto  | > rest-express@1.0.0 db:push
simulavoto  | > drizzle-kit push
simulavoto  | 
simulavoto  | No config path provided, using default 'drizzle.config.ts'
simulavoto  | Reading config file '/app/drizzle.config.ts'
simulavoto  | Using 'pg' driver for database querying
simulavoto  | [⣷] Pulling schema from database...
[⣯] Pulling schema from database...
[⣟] Pulling schema from database...
[⡿] Pulling schema from database...
[⢿] Pulling schema from database...
[⣻] Pulling schema from database...
[⣽] Pulling schema from database...
[⣷] Pulling schema from database...
[⣯] Pulling schema from database...
[⣟] Pulling schema from database...
[⡿] Pulling schema from database...
[⢿] Pulling schema from database...
[⣻] Pulling schema from database...
[⣽] Pulling schema from database...
[⣷] Pulling schema from database...
[⣯] Pulling schema from database...
[⣟] Pulling schema from database...
[⡿] Pulling schema from database...
[⢿] Pulling schema from database...
[⣻] Pulling schema from database...
[⣽] Pulling schema from database...
[⣷] Pulling schema from database...
[⣯] Pulling schema from database...
[⣟] Pulling schema from database...
[⡿] Pulling schema from database...
[⢿] Pulling schema from database...
[⣻] Pulling schema from database...
[⣽] Pulling schema from database...
[⣷] Pulling schema from database...
[✓] Pulling schema from database...
simulavoto  | [✓] Changes applied
simulavoto  | npm notice
simulavoto  | npm notice New major version of npm available! 10.8.2 -> 11.10.0
simulavoto  | npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.10.0
simulavoto  | npm notice To update run: npm install -g npm@11.10.0
simulavoto  | npm notice
simulavoto  | db:push completed successfully!
simulavoto  | 
simulavoto  | Starting application...
simulavoto  | 
simulavoto  | > rest-express@1.0.0 start
simulavoto  | > NODE_ENV=production node dist/index.cjs
simulavoto  | 
simulavoto  | Starting database initialization...
simulavoto  | NODE_ENV: production
simulavoto  | DATABASE_URL exists: true
simulavoto  | Database mode: EXTERNAL (Supabase/cloud)
simulavoto  | DATABASE_URL host: 72.60.255.204
simulavoto  | DATABASE_URL port: 5432
simulavoto  | DATABASE_URL protocol: postgresql:
simulavoto  | Resolving external database hostname to IPv4...
simulavoto  | SSL mode: auto (DATABASE_SSL=auto)
simulavoto  | SSL: auto - trying with SSL first...
simulavoto  | SSL: connection with SSL failed, trying without SSL...
simulavoto  | SSL error: The server does not support SSL connections
simulavoto  | SSL: connected successfully WITHOUT SSL
simulavoto  | Database pool initialized successfully
simulavoto  | Testing database connection...
simulavoto  | Database connection test successful!
simulavoto  | Registering routes...
simulavoto  | [Startup] Checking for stuck import jobs from previous crash...
simulavoto  | [Startup] No stuck import jobs found.
simulavoto  | Routes registered successfully!
simulavoto  | WebSocket server initialized on /ws/imports
simulavoto  | WebSocket server initialized
simulavoto  | 6:01:42 PM [express] serving on port 5000
simulavoto  | Report scheduler started (checking every 5 minutes)
simulavoto  | 6:01:46 PM [express] HEAD /api/health 200 in 18ms :: {"status":"healthy","timestamp":"2026-02-18T18:01:46.026Z","version":"1.0.0","database":"connected","stats":{"parties":32,"candidates":4}}
simulavoto  | [Auth] Login successful: user 'admin' (role: admin)
simulavoto  | [Auth] Debug: protocol=https, secure=true, x-forwarded-proto=https, trust-proxy=1
simulavoto  | [Auth] req.login() failed for user 'admin': Error: ENOENT: no such file or directory, open '/app/dist/table.sql'
simulavoto  |     at async open (node:internal/fs/promises:634:25)
simulavoto  |     at async Object.readFile (node:internal/fs/promises:1236:14)
simulavoto  |     at async n._rawEnsureSessionStoreTable (/app/dist/index.cjs:58:28765)
simulavoto  |     at async n._asyncQuery (/app/dist/index.cjs:58:29850) {
simulavoto  |   errno: -2,
simulavoto  |   code: 'ENOENT',
simulavoto  |   syscall: 'open',
simulavoto  |   path: '/app/dist/table.sql'
simulavoto  | }
simulavoto  | 6:02:05 PM [express] POST /api/auth/login 500 in 78ms :: {"error":"Login failed"}
simulavoto  | Error [ERR_HTTP_HEADERS_SENT]: Cannot set headers after they are sent to the client
simulavoto  |     at ServerResponse.setHeader (node:_http_outgoing:655:11)
simulavoto  |     at zt.set.zt.header (/app/dist/index.cjs:41:170727)
simulavoto  |     at zt.send (/app/dist/index.cjs:41:166266)
simulavoto  |     at zt.json (/app/dist/index.cjs:41:167396)
simulavoto  |     at e.json (/app/dist/index.cjs:1236:13942)
simulavoto  |     at /app/dist/index.cjs:1236:14500
simulavoto  |     at Xo.handle_error (/app/dist/index.cjs:19:3060)
simulavoto  |     at M (/app/dist/index.cjs:26:3700)
simulavoto  |     at /app/dist/index.cjs:26:3314
simulavoto  |     at As.process_params (/app/dist/index.cjs:26:3840)
simulavoto  |     at Immediate.N (/app/dist/index.cjs:26:3241)
simulavoto  |     at process.processImmediate (node:internal/timers:485:21)
simulavoto  | 6:02:16 PM [express] HEAD /api/health 200 in 8ms :: {"status":"healthy","timestamp":"2026-02-18T18:02:16.114Z","version":"1.0.0","database":"connected","stats":{"parties":32,"candidates":4}}

